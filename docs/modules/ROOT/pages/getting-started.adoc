= Getting Started with Teak in Unity for iOS

Intro intro intro intro intro intro intro intro intro https://docs.teak.io/usage/notifications.html[push notifications]. All of those options start with the same basic setup, which we'll step through below.

By the end of this guide, you'll see your iOS device on your Teak dashboard and send your first push notification to the device.

== Things You'll Need

To follow this guide and get started with Teak, you'll need to prepare a few things:

* A Unity game with user authentication or device identification set up
* An https://developer.apple.com/[Apple Developer] account and https://developer.apple.com/xcode/[XCode] installation
* A https://app.teak.io/signup[Teak account]
* Basic familiarity with installing and customizing https://docs.unity3d.com/Manual/AssetWorkflow.html[assets in Unity], particularly https://docs.unity3d.com/Manual/ScriptingAssets.html[scripting with assets]
* A code editor to edit your Unity scripts

Once you've got those, you'll be ready to add Teak to your Unity iOS game!


== Install the Teak SDK

=== 1. Create a New Game in Teak

First things first—log in to your Teak account and add a new game if you don't have one already.

If you already have a game and want to add another, you can find "New Game," in the game picker drop down.

image:start/newgame.png[New Game in Teak]



=== 2. Get your App ID and API Key

Once you've completed the series of dialogs and added your game, navigate to the Settings panel for your game to get your App ID and API Key. You'll add those to Unity shortly.

Now is also a good time to set up https://docs.teak.io/usage/links.html[Short Links], which are required for https://docs.teak.io/usage/rewards.html#_bundle_creation[rewarding] and https://docs.teak.io/usage/email.html[email]. To do so, enter the base URL you will use to generate links for rewards and other player interactions. It's possible to proceed without ShortLinks, but filling this now will save you an extra step later on.

image:start/settings.png[Teak Settings Page]


=== 3. Install Teak in your Unity Project

The easiest way to install Teak is using the Unity Package Manager. Add the Teak SDK package via https://docs.unity3d.com/Manual/upm-ui-giturl.html[Git URL].

image:start/addpackage.png[Add package in Unity]

In the dialog box, enter this URL for the latest Teak SDK:

https://github.com/GoCarrot/upm-package-teak.git

Alternatively, you can https://sdks.teakcdn.com/unity/Teak.unitypackage[download Teak] directly and import it as a custom package from the Assets menu in your Unity project.


=== 4. Configure Teak in your game

After installation, you should see Teak in the Edit menu in your Unity project. Selecting it will open it in your Inspector.

image:start/editmenu.png[Teak in Unity Edit menu]

image:start/inspector.png[Unity Inspector]


Add your App ID and API Key from your Teak Settings. These keys allow your game to authenticate and talk to Teak.

If you set up ShortLinks when you added your app on Teak, enter the same base URL here.

By default, the checkbox for "Build Post-Processing" will be checked. This automates the native iOS and Android integration. Unless you've worked extensively with Teak before, you should leave this option on.


== Identify a User with Teak

It's time to tell Teak about your players so you can start logging sessions, gathering metrics, and sending rewards. The first step is to identify a player.

We assume your game uses a player ID to store progress, coin balances, and other useful data. All Teak needs is that ID; it doesn't require full user authentication, just a way to uniquely identify players or devices.


=== 1. Locate your player IDs in your game scripts

The only data point Teak needs from your game is a player ID. This should be the same ID you use in your game's backend, as that will keep code cleaner and make support simpler. Your Teak connection should be initialized wherever you first identify a player, as early as possible in your game's lifecycle, so you can log complete player sessions.

If you are authenticating users in your game, you will want to send the player ID to Teak in your authentication handler method.

If you do not have authentication, you can implement your own method to identify users with a unique string or, on iOS, use https://developer.apple.com/documentation/uikit/uidevice/1620059-identifierforvendor[`identifierForVendor`], which uses your App Store bundle ID and a device ID and is compliant with Apple's privacy requirements.

Find the script where you identify your user and open it in your code editor. Eventually, you'll add Teak functionality to other scripts to send push notifications during different stages of game play. But for now, our goal is just to identify a player, so we're only looking at this one file.


=== 2. Add Teak to your game script


So far, you've set up Teak to accept requests from your game app, loaded Teak in your Unity project, and located where your game identifies players. Now, you're ready to connect Teak to your game!



* First, add Teak to the ‘using' declarations & MonoBehaviour properties in the appropriate game script:

[source, csharp]
----

//…

using static Teak;

----

Teak is now available for use in this file. The https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/static[`static` keyword] imports Teak as its own type, without making it an object property of the MonoBehaviour, which means that you will call Teak's own `Instance` property directly, rather than creating a cached instance within the script.

* Create a Teak Instance in your Start() method.


[source, csharp]
----

//…

void Start()

{
  Teak.Instance.Trace = true;
  //…
}
----

Setting `Teak.Trace` to `true` will turn on automatic debugging - you'll know it's working because you'll see the Teak version in your console logs when the Start() method is called. RegisterForNotifications` configures Teak for push notifications, which are the main way to use Teak to interact with players.


=== 3. Send your player IDs to Teak


Now let's send the first piece of player data to Teak!

* Create a method that calls https://docs.teak.io/unity/latest/api/classTeak.html#classTeak_1aea6260058a77c4d85d7c031cb4e2e68b[Teak.IdentifyUser()]:

[source, csharp]
----

public void identifyTeakUser(string userIdentifier)


{


    UserConfiguration userConfiguration = new UserConfiguration {


        Email = EmailInput.text


    };


    Teak.Instance.IdentifyUser(userIdentifier, userConfiguration);


}

----

This method has two parameters. The first is a `userIdentifier` string, which must be unique to the player—and again, we highly recommend using the same string you use elsewhere in your application. This argument is required.

The second parameter, https://docs.teak.io/unity/latest/api/classTeak_1_1UserConfiguration.html[UserConfiguration], is optional. If you don't define a `userConfiguration`, Teak will create an empty object for this user, which you can update later. The example above shows how you might pass in a form input for a user email address. You can also use UserConfiguration to keep track of a user's Facebook ID or privacy settings.

* Then call your Teak user method when a user is successfully identified by your backend:

[source, csharp]
----
private void handleSuccessfulIdentification(string playerID)
{
    //code executed when player ID is confirmed by your backend
    identifyTeakUser(playerID);
}
----

As discussed above, you likely already have a handler method that is called when a user is first identified. Because you want Teak to track a complete user session, identifying a user for Teak in the handler method gets that data recorded as early as possible in the player journey.

=== 4. Ask the player for permission

On iOS you are required to ask the user if you can send them notifications. Do that with the RegisterForNotifications call.

Ideally, you would ask for these permissions at a time that makes sense for your game. In the long term, you can increase your notification opt-in rates by being strategic about when you ask for permission.

But for the purpose of getting up and running fast, let's just put the permissions request right here at game launch. \

[source, csharp]
----
private void handleSuccessfulIdentification(string playerID)
{
  //code executed when player ID is confirmed by your backend
  identifyTeakUser(userIdentifier);
  Teak.Instance.RegisterForNotifications();
}
----

Now your game will ask for push permissions when you launch the game. Make sure to approve them on your test device, so that we can send our notification at the end of this tutorial.

== Testing Your Teak Installation

Testing SDK integrations in Unity can be a little tricky. Teak can't talk to Teak's servers from inside the Unity Editor. But there are a few things we can do to make sure things are installed correctly.

* If the Teak package is successfully installed and called, you will see the following message in the console.  \


----
[Teak] Unity SDK Version: 4.1.14
----

* We can turn on additional debug logging with `Trace.` Add this before your IdentifyUser call. \


[source, csharp]
----
Teak.Instance.Trace = true;
----

* With Trace turned on, you will see logging for additional function calls, such as the following.

----
[Teak] IdentifyUser(): the_unique_player_id
----

You'll find more logging options in https://docs.teak.io/unity/latest/debugging.html[Debugging Your Code with Teak] that will help as you build more Teak functionality into your game. But before that, it's time to get your game built and running on a test device, and see your player in the Teak dashboard.


== Getting Teak on Your iOS Device

=== 1. Ensure you have an Apple Developer account

    You will need an Apple Developer account to use push notifications. While you can work in XCode and test code on your own devices with just your Apple ID, you won't be able to use Teak's notifications on iOS devices without a <span style="text-decoration:underline;">paid membership</span>.

If you have an Organization membership, you can add additional members to your team and specify roles. Only team members with an App Manager, Admin, or Account Holder role will be able to configure push notifications.


=== 2. Configure Apple push notification certificates and upload to Teak

    These certificates are separate from your Development and Distribution certificates; follow the detailed instructions here if you're not familiar with creating certificates. Here's a quick summary of the process:

* Enable push notifications for your game on your Apple Developer portal.
* Create a new Certificate Signing Request from your Keychain and upload to Apple.
* Download your new certificate from Apple and open it in Keychain.
* Export the certificate as a .p12 file.
* Upload the certificate to Teak from your Teak dashboard. Go to Settings > Mobile and click "Manage APNS Certificates" in the "iOS" section of the page.


=== 3. Create a new iOS build

In Unity, select File > Build Settings. Click on Player Settings. Double check that the bundle ID on your .p12 certificate (something like "com.MyGameCo.MyGame") matches the bundle ID in your Player Settings. Ensure that you are building for iOS, and create a new build that will include Teak. Open your new build in Xcode.

You should now see Teak in the Targets menu in the sidebar.  Go to the Signing & Capabilities tab:

image:start/xcodesigning.png[Signing in Xcode]

Selecting "Automatically manage signing" and choosing the development team associated with this application should sign everything, including the TeakNotificationService and TeakNotificationContent. Double check by opening them from the Targets menu and looking to see that your signing certificate is listed.

Make sure that the Push Notifications icon shows up in the settings for your main target app. If not, click the "+" button on the ribbon above your Signing settings, find Push Notifications, and double-click to add it.

Now you're ready to build your app as usual and get it onto your iOS device.


=== 4. Connect an iOS device

Once your new app is on your iOS device, opening it should pop up a dialog box asking for permission to send notifications. Click Allow, and begin playing your game. Once you reach the point where your game script identifies a player, you've done everything you need to see Teak working.


== Seeing Your Active User

If you've followed along so far, you can now go back to your Teak dashboard to see your active user.

image:start/activeuser.png[alt_text]

When you built and opened your game on your device, you got evidence that the game was configured for push notifications. Now, you can see that active user on your Teak dashboard.


== Sending Your First Notification

Now let's send our first notification to that user. We'll create a message from the Teak dashboard, select a recipient, and see the notification on our device.


=== Create a Message to Send

In the Teak dashboard for your game, set up your first notification.

Click on Notifications, select iOS Push, and then click New Message.

image:start/dashboard.png[alt_text]

Now set up a modal. Give your message a Name, and select the platforms you want to create content for. (We'll just do iOS for now.) Click Next.

image:start/newmessage.png[alt_text]

Enter your desired message, and click Next.

image:start/newmessagecontent.png[alt_text]

Review and save your message. You'll now see it in the messages list.

image:start/savemessage.png[alt_text]

Now, we need to send our message to the device. Later, we'll set up Audiences to target groups of players, but for now, we just want to send this message to our device. We'll use Preview for that.


=== Add a Preview Recipient

Previews are useful for testing messages. To create a Preview, we need to tell Teak who we want to send to.

You should see your message in the messages list on the Teak dashboard. Click Preview.

image:start/previewbutton.png[alt_text]

Then select Add Recipients.

image:start/previewempty.png[alt_text]

Enter your player ID (or `userIdentifier`) in the Search by Game User ID field. You can get this from your game on the test device (if it displays the player ID) or from the console log (Teak will output it when Identify User is called).

Click Search, and then click Register when your device is found.

image:start/searchrecipients.png[alt_text]

Add a label so you can keep your test devices straight, and click Save. Other team members you invite to this game will be able to see your test devices, so choose a name that is helpful for the whole team.

image:start/registerrecipients.png[alt_text]

Your test device is now saved for this game. The next time you want to preview a message, you can just select your device from the list.


=== Send Preview

Almost there! Let's send the notification to your device.

First, make sure your game is not open on your device. By default, notifications don't show up if the game is already in the foreground.

Then, from the message preview in the Teak dashboard, click Send Preview.

image:start/sendpreview.png[alt_text]

The notification should show up on your device!

image:start/hello.jpg[alt_text]

Congratulations, you've sent your first push notification using Teak!


= Next Steps

From here, you can customize notifications and metrics based on your particular use cases. Check out our other guides and extensive https://docs.teak.io/sdk-reference/index.html[documentation] for more detail on how to make Teak's tracking work for you and your games!
